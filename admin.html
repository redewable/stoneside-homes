<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Stoneside Admin Dashboard</title>
  <meta name="robots" content="noindex, nofollow" />
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet" />
  
  <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-database-compat.js"></script>

<script>
  // Your specific Stoneside configuration
  const firebaseConfig = {
    apiKey: "AIzaSyBHlWoOF3rSzCpXwazwbAMZI2MbezolZ4c",
    authDomain: "stoneside-homes.firebaseapp.com",
    projectId: "stoneside-homes",
    storageBucket: "stoneside-homes.firebasestorage.app",
    messagingSenderId: "1065540993417",
    appId: "1:1065540993417:web:b081764db2ec18bad1a158"
  };

  // Initialize Firebase
  firebase.initializeApp(firebaseConfig);
  const db = firebase.database(); // Now 'db' is ready to use in your other scripts
</script>
  
  <style>
    :root {
      --bg: #0f0f0f;
      --bg-card: #1a1a1a;
      --bg-input: #252525;
      --border: #333;
      --text: #f5f5f5;
      --text-muted: #888;
      --accent: #9d7b5a;
      --accent-light: #c4a882;
      --success: #4ade80;
      --error: #f87171;
      --warning: #fbbf24;
    }

    * { box-sizing: border-box; margin: 0; padding: 0; }

    body {
      font-family: 'Inter', -apple-system, sans-serif;
      background: var(--bg);
      color: var(--text);
      min-height: 100vh;
    }

    .hidden { display: none !important; }

    /* Layout */
    .admin-layout {
      display: grid;
      grid-template-columns: 260px 1fr;
      min-height: 100vh;
    }

    @media (max-width: 900px) {
      .admin-layout { grid-template-columns: 1fr; }
      .sidebar { display: none; }
      .sidebar.mobile-open { display: flex; position: fixed; inset: 0; z-index: 100; }
    }

    /* Sidebar */
    .sidebar {
      background: var(--bg-card);
      border-right: 1px solid var(--border);
      padding: 24px;
      display: flex;
      flex-direction: column;
      position: sticky;
      top: 0;
      height: 100vh;
      overflow-y: auto;
    }

    .sidebar-logo { font-size: 1.25rem; font-weight: 700; margin-bottom: 8px; }
    .sidebar-subtitle {
      font-size: 0.75rem;
      color: var(--text-muted);
      text-transform: uppercase;
      letter-spacing: 0.1em;
      margin-bottom: 32px;
    }

    .sidebar-nav { display: flex; flex-direction: column; gap: 4px; }

    .nav-link {
      display: flex;
      align-items: center;
      gap: 12px;
      padding: 12px 16px;
      font-size: 0.875rem;
      font-weight: 500;
      color: var(--text-muted);
      text-decoration: none;
      border-radius: 8px;
      border: none;
      background: none;
      cursor: pointer;
      transition: all 0.2s;
      text-align: left;
      width: 100%;
    }

    .nav-link:hover, .nav-link.active {
      background: var(--bg-input);
      color: var(--text);
    }

    .nav-link.active { border-left: 3px solid var(--accent); margin-left: -3px; }

    .nav-icon { width: 20px; height: 20px; opacity: 0.7; flex-shrink: 0; }

    .sidebar-footer {
      margin-top: auto;
      padding-top: 24px;
      border-top: 1px solid var(--border);
    }

    .view-site-btn, .logout-btn {
      display: flex;
      align-items: center;
      gap: 12px;
      width: 100%;
      padding: 12px 16px;
      font-size: 0.875rem;
      color: var(--text-muted);
      background: none;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      transition: all 0.2s;
      text-decoration: none;
    }

    .view-site-btn:hover { background: var(--bg-input); color: var(--accent); }
    .logout-btn:hover { background: var(--bg-input); color: var(--error); }

    /* Main Content */
    .main-content { padding: 32px; overflow-y: auto; max-height: 100vh; }

    .page-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 32px;
      flex-wrap: wrap;
      gap: 16px;
    }

    .page-title { font-size: 1.75rem; font-weight: 700; }
    .page-subtitle { color: var(--text-muted); font-size: 0.875rem; margin-top: 4px; }

    /* Cards */
    .card {
      background: var(--bg-card);
      border: 1px solid var(--border);
      border-radius: 12px;
      padding: 24px;
      margin-bottom: 24px;
    }

    .card-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 20px;
      padding-bottom: 16px;
      border-bottom: 1px solid var(--border);
    }

    .card-title { font-size: 1rem; font-weight: 600; }
    .card-badge {
      font-size: 0.625rem;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.05em;
      padding: 4px 10px;
      background: var(--accent);
      color: var(--bg);
      border-radius: 100px;
    }

    /* Forms */
    .form-grid {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 20px;
    }

    @media (max-width: 700px) {
      .form-grid { grid-template-columns: 1fr; }
    }

    .form-group { display: flex; flex-direction: column; gap: 8px; }
    .form-group.full-width { grid-column: 1 / -1; }

    .form-label {
      font-size: 0.75rem;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.05em;
      color: var(--text-muted);
    }

    .form-input, .form-textarea, .form-select {
      width: 100%;
      padding: 12px 16px;
      font-family: inherit;
      font-size: 0.875rem;
      color: var(--text);
      background: var(--bg-input);
      border: 1px solid var(--border);
      border-radius: 8px;
      transition: border-color 0.2s, box-shadow 0.2s;
    }

    .form-input:focus, .form-textarea:focus, .form-select:focus {
      outline: none;
      border-color: var(--accent);
      box-shadow: 0 0 0 3px rgba(157, 123, 90, 0.2);
    }

    .form-textarea { min-height: 100px; resize: vertical; }

    .form-help {
      font-size: 0.75rem;
      color: var(--text-muted);
      margin-top: 4px;
    }

    /* Buttons */
    .btn {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
      padding: 10px 20px;
      font-family: inherit;
      font-size: 0.875rem;
      font-weight: 600;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      transition: all 0.2s;
    }

    .btn-primary {
      background: var(--accent);
      color: var(--bg);
    }
    .btn-primary:hover { background: var(--accent-light); }

    .btn-secondary {
      background: var(--bg-input);
      color: var(--text);
      border: 1px solid var(--border);
    }
    .btn-secondary:hover { border-color: var(--text-muted); }

    .btn-danger {
      background: transparent;
      color: var(--error);
      border: 1px solid var(--error);
    }
    .btn-danger:hover { background: var(--error); color: var(--bg); }

    .btn-sm { padding: 6px 12px; font-size: 0.75rem; }

    .btn-icon {
      width: 36px;
      height: 36px;
      padding: 0;
      border-radius: 8px;
    }

    /* Section Content */
    .section-content { display: none; }
    .section-content.active { display: block; }

    /* Tabs */
    .tabs {
      display: flex;
      gap: 4px;
      margin-bottom: 24px;
      border-bottom: 1px solid var(--border);
      flex-wrap: wrap;
    }

    .tab {
      padding: 12px 20px;
      font-size: 0.875rem;
      font-weight: 500;
      color: var(--text-muted);
      background: none;
      border: none;
      border-bottom: 2px solid transparent;
      cursor: pointer;
      transition: all 0.2s;
    }

    .tab:hover { color: var(--text); }
    .tab.active { color: var(--accent); border-bottom-color: var(--accent); }

    .tab-content { display: none; }
    .tab-content.active { display: block; }

    /* Editable List Items */
    .editable-list { display: flex; flex-direction: column; gap: 12px; }

    .editable-item {
      display: grid;
      grid-template-columns: 1fr auto;
      gap: 12px;
      padding: 16px;
      background: var(--bg);
      border: 1px solid var(--border);
      border-radius: 8px;
      align-items: start;
    }

    .editable-item-content { display: flex; flex-direction: column; gap: 12px; }
    .editable-item-row { display: grid; grid-template-columns: 100px 1fr; gap: 12px; align-items: center; }
    .editable-item-row label { font-size: 0.75rem; color: var(--text-muted); }
    .editable-item-actions { display: flex; flex-direction: column; gap: 8px; }

    .add-item-btn {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
      padding: 16px;
      background: transparent;
      border: 2px dashed var(--border);
      border-radius: 8px;
      color: var(--text-muted);
      cursor: pointer;
      transition: all 0.2s;
      width: 100%;
      font-size: 0.875rem;
    }

    .add-item-btn:hover {
      border-color: var(--accent);
      color: var(--accent);
    }

    /* Icon Picker */
    .icon-picker {
      display: grid;
      grid-template-columns: repeat(6, 1fr);
      gap: 8px;
      padding: 12px;
      background: var(--bg);
      border: 1px solid var(--border);
      border-radius: 8px;
      max-height: 200px;
      overflow-y: auto;
    }

    .icon-option {
      width: 40px;
      height: 40px;
      display: flex;
      align-items: center;
      justify-content: center;
      background: var(--bg-input);
      border: 2px solid transparent;
      border-radius: 8px;
      cursor: pointer;
      transition: all 0.2s;
    }

    .icon-option:hover { border-color: var(--text-muted); }
    .icon-option.selected { border-color: var(--accent); background: rgba(157, 123, 90, 0.2); }
    .icon-option svg { width: 24px; height: 24px; color: var(--text); }

    /* Projects List */
    .projects-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
      gap: 20px;
    }

    .project-card {
      background: var(--bg);
      border: 1px solid var(--border);
      border-radius: 12px;
      overflow: hidden;
      transition: all 0.2s;
    }

    .project-card:hover { border-color: var(--accent); }

    .project-card-image {
      width: 100%;
      height: 180px;
      object-fit: cover;
      background: var(--bg-input);
    }

    .project-card-content { padding: 16px; }
    .project-card-type {
      font-size: 0.625rem;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.05em;
      color: var(--accent);
      margin-bottom: 4px;
    }
    .project-card-title { font-size: 1rem; font-weight: 600; margin-bottom: 4px; }
    .project-card-meta { font-size: 0.75rem; color: var(--text-muted); margin-bottom: 12px; }
    .project-card-actions { display: flex; gap: 8px; }

    /* Modal */
    .modal-overlay {
      position: fixed;
      inset: 0;
      background: rgba(0, 0, 0, 0.8);
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 24px;
      z-index: 1000;
      opacity: 0;
      visibility: hidden;
      transition: all 0.3s;
    }

    .modal-overlay.active { opacity: 1; visibility: visible; }

    .modal {
      background: var(--bg-card);
      border: 1px solid var(--border);
      border-radius: 16px;
      width: 100%;
      max-width: 600px;
      max-height: 90vh;
      overflow-y: auto;
    }

    .modal-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 20px 24px;
      border-bottom: 1px solid var(--border);
    }

    .modal-title { font-size: 1.25rem; font-weight: 600; }

    .modal-close {
      width: 32px;
      height: 32px;
      display: flex;
      align-items: center;
      justify-content: center;
      background: var(--bg-input);
      border: none;
      border-radius: 8px;
      color: var(--text-muted);
      cursor: pointer;
      transition: all 0.2s;
    }

    .modal-close:hover { color: var(--text); }

    .modal-body { padding: 24px; }
    .modal-footer {
      display: flex;
      justify-content: flex-end;
      gap: 12px;
      padding: 20px 24px;
      border-top: 1px solid var(--border);
    }

    /* Toast */
    .toast-container {
      position: fixed;
      bottom: 24px;
      right: 24px;
      z-index: 1001;
      display: flex;
      flex-direction: column;
      gap: 12px;
    }

    .toast {
      display: flex;
      align-items: center;
      gap: 12px;
      padding: 16px 20px;
      background: var(--bg-card);
      border: 1px solid var(--border);
      border-radius: 8px;
      box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
      animation: slideIn 0.3s ease-out;
    }

    .toast.success { border-color: var(--success); }
    .toast.error { border-color: var(--error); }

    .toast-icon { width: 20px; height: 20px; flex-shrink: 0; }
    .toast.success .toast-icon { color: var(--success); }
    .toast.error .toast-icon { color: var(--error); }
    .toast-message { font-size: 0.875rem; }

    @keyframes slideIn {
      from { transform: translateX(100%); opacity: 0; }
      to { transform: translateX(0); opacity: 1; }
    }

    /* Login Screen */
    .login-screen {
      min-height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 24px;
    }

    .login-card {
      width: 100%;
      max-width: 400px;
      background: var(--bg-card);
      border: 1px solid var(--border);
      border-radius: 16px;
      padding: 40px;
    }

    .login-logo { font-size: 1.5rem; font-weight: 700; text-align: center; margin-bottom: 8px; }
    .login-subtitle {
      font-size: 0.875rem;
      color: var(--text-muted);
      text-align: center;
      margin-bottom: 32px;
    }

    .login-form { display: flex; flex-direction: column; gap: 20px; }
    .login-btn { width: 100%; padding: 14px; }

    /* Preview */
    .preview-frame {
      width: 100%;
      height: 400px;
      border: 1px solid var(--border);
      border-radius: 8px;
      background: var(--bg);
    }
  </style>
</head>

<body>
  <!-- Toast Container -->
  <div class="toast-container" id="toastContainer"></div>

  <!-- Login Screen -->
  <div class="login-screen" id="loginScreen">
    <div class="login-card">
      <div class="login-logo">Stoneside</div>
      <div class="login-subtitle">Admin Dashboard</div>
      <form class="login-form" id="loginForm">
        <div class="form-group">
          <label class="form-label">Email</label>
          <input type="email" class="form-input" id="loginEmail" required />
        </div>
        <div class="form-group">
          <label class="form-label">Password</label>
          <input type="password" class="form-input" id="loginPassword" required />
        </div>
        <button type="submit" class="btn btn-primary login-btn" id="loginBtn">Sign In</button>
        <p id="loginError" style="color: #f87171; font-size: 0.8rem; margin-top: 12px; display: none;"></p>
      </form>
    </div>
  </div>

  <!-- Admin Dashboard -->
  <div class="admin-layout hidden" id="adminDashboard">
    <!-- Sidebar -->
    <aside class="sidebar" id="sidebar">
      <div class="sidebar-logo">Stoneside</div>
      <div class="sidebar-subtitle">Admin Dashboard</div>
      
      <nav class="sidebar-nav">
        <button type="button" class="nav-link active" data-section="hero">
          <svg class="nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <rect x="3" y="3" width="18" height="18" rx="2"/><path d="M3 9h18"/>
          </svg>
          Hero Section
        </button>
        <button type="button" class="nav-link" data-section="content">
          <svg class="nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/>
            <path d="M14 2v6h6M16 13H8M16 17H8M10 9H8"/>
          </svg>
          Page Content
        </button>
        <button type="button" class="nav-link" data-section="projects">
          <svg class="nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <rect x="3" y="3" width="7" height="7"/><rect x="14" y="3" width="7" height="7"/>
            <rect x="14" y="14" width="7" height="7"/><rect x="3" y="14" width="7" height="7"/>
          </svg>
          Projects
        </button>
        <button type="button" class="nav-link" data-section="testimonials">
          <svg class="nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"/>
          </svg>
          Testimonials
        </button>
        <button type="button" class="nav-link" data-section="settings">
          <svg class="nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <circle cx="12" cy="12" r="3"/>
            <path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"/>
          </svg>
          Settings
        </button>
      </nav>
      
      <div class="sidebar-footer">
        <a href="index.html" target="_blank" class="view-site-btn">
          <svg class="nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"/>
            <polyline points="15 3 21 3 21 9"/><line x1="10" y1="14" x2="21" y2="3"/>
          </svg>
          View Site
        </a>
        <button type="button" class="logout-btn" id="logoutBtn">
          <svg class="nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"/>
            <polyline points="16 17 21 12 16 7"/><line x1="21" y1="12" x2="9" y2="12"/>
          </svg>
          Sign Out
        </button>
      </div>
    </aside>

    <!-- Main Content -->
    <main class="main-content">
      
      <!-- ══════════════════════════════════════════════════════════════════
           HERO SECTION
      ══════════════════════════════════════════════════════════════════ -->
      <section class="section-content active" id="section-hero">
        <div class="page-header">
          <div>
            <h1 class="page-title">Hero Section</h1>
            <p class="page-subtitle">Manage the main hero content on your homepage</p>
          </div>
          <button class="btn btn-primary" id="saveHero">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z"/>
              <polyline points="17 21 17 13 7 13 7 21"/><polyline points="7 3 7 8 15 8"/>
            </svg>
            Save Changes
          </button>
        </div>

        <div class="card">
          <div class="card-header">
            <h2 class="card-title">Hero Content</h2>
            <span class="card-badge">Live</span>
          </div>
          
          <div class="form-grid">
            <div class="form-group">
              <label class="form-label">Title Line 1 - Word 1</label>
              <input type="text" class="form-input" id="heroTitle1Word1" value="Where" />
            </div>
            <div class="form-group">
              <label class="form-label">Title Line 1 - Word 2</label>
              <input type="text" class="form-input" id="heroTitle1Word2" value="Blueprints" />
            </div>
            <div class="form-group">
              <label class="form-label">Title Line 2 - Word 1</label>
              <input type="text" class="form-input" id="heroTitle2Word1" value="Become" />
            </div>
            <div class="form-group">
              <label class="form-label">Title Line 2 - Word 2 (Accent)</label>
              <input type="text" class="form-input" id="heroTitle2Word2" value="Legacy" />
            </div>
            <div class="form-group full-width">
              <label class="form-label">Subtitle</label>
              <textarea class="form-textarea" id="heroSubtitle">Custom homes built with the patience of experience, the discipline of tradition, and the care of a family name.</textarea>
            </div>
            <div class="form-group">
              <label class="form-label">Location Text</label>
              <input type="text" class="form-input" id="heroLocation" value="Bryan–College Station, Texas" />
            </div>
            <div class="form-group">
              <label class="form-label">Years Badge</label>
              <input type="text" class="form-input" id="heroYears" value="40 Years" />
            </div>
          </div>
        </div>

        <div class="card">
          <div class="card-header">
            <h2 class="card-title">Stats Section</h2>
          </div>
          
          <div class="form-grid">
            <div class="form-group">
              <label class="form-label">Stat 1 Value</label>
              <input type="text" class="form-input" id="stat1Value" value="40" />
            </div>
            <div class="form-group">
              <label class="form-label">Stat 1 Label</label>
              <input type="text" class="form-input" id="stat1Label" value="Years of Excellence" />
            </div>
            <div class="form-group">
              <label class="form-label">Stat 2 Value</label>
              <input type="text" class="form-input" id="stat2Value" value="∞" />
            </div>
            <div class="form-group">
              <label class="form-label">Stat 2 Label</label>
              <input type="text" class="form-input" id="stat2Label" value="Patience" />
            </div>
            <div class="form-group">
              <label class="form-label">Stat 3 Value</label>
              <input type="text" class="form-input" id="stat3Value" value="1" />
            </div>
            <div class="form-group">
              <label class="form-label">Stat 3 Label</label>
              <input type="text" class="form-input" id="stat3Label" value="Promise" />
            </div>
          </div>
        </div>
      </section>

      <!-- ══════════════════════════════════════════════════════════════════
           PAGE CONTENT SECTION
      ══════════════════════════════════════════════════════════════════ -->
      <section class="section-content" id="section-content">
        <div class="page-header">
          <div>
            <h1 class="page-title">Page Content</h1>
            <p class="page-subtitle">Edit all section content throughout the site</p>
          </div>
          <button class="btn btn-primary" id="saveContent">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z"/>
              <polyline points="17 21 17 13 7 13 7 21"/><polyline points="7 3 7 8 15 8"/>
            </svg>
            Save All Content
          </button>
        </div>

        <div class="tabs">
          <button class="tab active" data-tab="legacy">Legacy</button>
          <button class="tab" data-tab="philosophy">Philosophy</button>
          <button class="tab" data-tab="portfolio">Portfolio</button>
          <button class="tab" data-tab="process">Process</button>
          <button class="tab" data-tab="contact">Contact</button>
        </div>

        <!-- Legacy Tab -->
        <div class="tab-content active" id="tab-legacy">
          <div class="card">
            <div class="card-header">
              <h2 class="card-title">Legacy Section</h2>
            </div>
            <div class="form-grid">
              <div class="form-group full-width">
                <label class="form-label">Section Title</label>
                <input type="text" class="form-input" id="legacyTitle" value="Four Decades of *Unwavering Excellence*" />
                <span class="form-help">Use *text* to make words italic/accent</span>
              </div>
              <div class="form-group full-width">
                <label class="form-label">Lead Text</label>
                <textarea class="form-textarea" id="legacyLead">In 1984, when most builders chased volume, we chose a different path—one measured not in units built, but in families served with excellence.</textarea>
              </div>
            </div>
          </div>

          <div class="card">
            <div class="card-header">
              <h2 class="card-title">Timeline Items</h2>
              <button class="btn btn-secondary btn-sm" id="addTimelineItem">+ Add Year</button>
            </div>
            <div class="editable-list" id="timelineList">
              <!-- Populated by JS -->
            </div>
          </div>
        </div>

        <!-- Philosophy Tab -->
        <div class="tab-content" id="tab-philosophy">
          <div class="card">
            <div class="card-header">
              <h2 class="card-title">Philosophy Section</h2>
            </div>
            <div class="form-grid">
              <div class="form-group full-width">
                <label class="form-label">Section Title</label>
                <input type="text" class="form-input" id="philosophyTitle" value="Building Is *Stewardship*" />
              </div>
              <div class="form-group full-width">
                <label class="form-label">Lead Text</label>
                <textarea class="form-textarea" id="philosophyLead">A home is where your children will take their first steps. Where holidays will gather decades of memories. Where legacy is quietly built.</textarea>
              </div>
            </div>
          </div>

          <div class="card">
            <div class="card-header">
              <h2 class="card-title">Philosophy Pillars</h2>
              <button class="btn btn-secondary btn-sm" id="addPillar">+ Add Pillar</button>
            </div>
            <div class="editable-list" id="pillarsList">
              <!-- Populated by JS -->
            </div>
          </div>

          <div class="card">
            <div class="card-header">
              <h2 class="card-title">Scripture Verse</h2>
            </div>
            <div class="form-grid">
              <div class="form-group full-width">
                <label class="form-label">Verse Text</label>
                <input type="text" class="form-input" id="philosophyVerse" value="As for me and my house, we will serve the Lord." />
              </div>
              <div class="form-group">
                <label class="form-label">Reference</label>
                <input type="text" class="form-input" id="philosophyVerseRef" value="Joshua 24:15" />
              </div>
            </div>
          </div>
        </div>

        <!-- Portfolio Tab -->
        <div class="tab-content" id="tab-portfolio">
          <div class="card">
            <div class="card-header">
              <h2 class="card-title">Portfolio Section</h2>
            </div>
            <div class="form-grid">
              <div class="form-group full-width">
                <label class="form-label">Section Title</label>
                <input type="text" class="form-input" id="portfolioTitle" value="Homes That *Tell Stories*" />
              </div>
              <div class="form-group full-width">
                <label class="form-label">Lead Text</label>
                <textarea class="form-textarea" id="portfolioLead">Every home begins as a drawing. What matters is what it becomes—a vessel for your family's story.</textarea>
              </div>
            </div>
          </div>
        </div>

        <!-- Process Tab -->
        <div class="tab-content" id="tab-process">
          <div class="card">
            <div class="card-header">
              <h2 class="card-title">Process Section</h2>
            </div>
            <div class="form-grid">
              <div class="form-group full-width">
                <label class="form-label">Section Title</label>
                <input type="text" class="form-input" id="processTitle" value="From First *Conversation* to Forever Home" />
              </div>
            </div>
          </div>

          <div class="card">
            <div class="card-header">
              <h2 class="card-title">Process Steps</h2>
              <button class="btn btn-secondary btn-sm" id="addProcessStep">+ Add Step</button>
            </div>
            <div class="editable-list" id="processStepsList">
              <!-- Populated by JS -->
            </div>
          </div>
        </div>

        <!-- Contact Tab -->
        <div class="tab-content" id="tab-contact">
          <div class="card">
            <div class="card-header">
              <h2 class="card-title">Contact Section</h2>
            </div>
            <div class="form-grid">
              <div class="form-group full-width">
                <label class="form-label">Section Title</label>
                <input type="text" class="form-input" id="contactTitle" value="Let's Build *Something* That Lasts" />
              </div>
              <div class="form-group full-width">
                <label class="form-label">Lead Text</label>
                <textarea class="form-textarea" id="contactLead">A short note is enough to begin. We'll schedule a call to discuss your vision, timeline, and whether we're the right fit.</textarea>
              </div>
            </div>
          </div>

          <div class="card">
            <div class="card-header">
              <h2 class="card-title">Contact Information</h2>
            </div>
            <div class="form-grid">
              <div class="form-group">
                <label class="form-label">Location</label>
                <input type="text" class="form-input" id="contactLocation" value="Bryan–College Station, TX" />
              </div>
              <div class="form-group">
                <label class="form-label">Phone</label>
                <input type="text" class="form-input" id="contactPhone" value="(979) 555-1984" />
              </div>
              <div class="form-group">
                <label class="form-label">Email</label>
                <input type="email" class="form-input" id="contactEmail" value="build@stonesidehomes.com" />
              </div>
              <div class="form-group">
                <label class="form-label">Response Time</label>
                <input type="text" class="form-input" id="contactResponse" value="Within 24 Hours" />
              </div>
            </div>
          </div>
        </div>
      </section>

      <!-- ══════════════════════════════════════════════════════════════════
           PROJECTS SECTION
      ══════════════════════════════════════════════════════════════════ -->
      <section class="section-content" id="section-projects">
        <div class="page-header">
          <div>
            <h1 class="page-title">Projects</h1>
            <p class="page-subtitle">Manage your portfolio of homes</p>
          </div>
          <button class="btn btn-primary" id="addProject">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <line x1="12" y1="5" x2="12" y2="19"/><line x1="5" y1="12" x2="19" y2="12"/>
            </svg>
            Add Project
          </button>
        </div>

        <div class="projects-grid" id="projectsGrid">
          <!-- Populated by JS -->
        </div>
      </section>

      <!-- ══════════════════════════════════════════════════════════════════
           TESTIMONIALS SECTION
      ══════════════════════════════════════════════════════════════════ -->
      <section class="section-content" id="section-testimonials">
        <div class="page-header">
          <div>
            <h1 class="page-title">Testimonials</h1>
            <p class="page-subtitle">Manage client reviews and quotes</p>
          </div>
          <button class="btn btn-primary" id="saveTestimonials">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z"/>
              <polyline points="17 21 17 13 7 13 7 21"/><polyline points="7 3 7 8 15 8"/>
            </svg>
            Save Changes
          </button>
        </div>

        <div class="card">
          <div class="card-header">
            <h2 class="card-title">Testimonials</h2>
            <button class="btn btn-secondary btn-sm" id="addTestimonial">+ Add Testimonial</button>
          </div>
          <div class="editable-list" id="testimonialsList">
            <!-- Populated by JS -->
          </div>
        </div>
      </section>

      <!-- ══════════════════════════════════════════════════════════════════
           SETTINGS SECTION
      ══════════════════════════════════════════════════════════════════ -->
      <section class="section-content" id="section-settings">
        <div class="page-header">
          <div>
            <h1 class="page-title">Settings</h1>
            <p class="page-subtitle">Configure site-wide settings</p>
          </div>
          <button class="btn btn-primary" id="saveSettings">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z"/>
              <polyline points="17 21 17 13 7 13 7 21"/><polyline points="7 3 7 8 15 8"/>
            </svg>
            Save Settings
          </button>
        </div>

        <div class="card">
          <div class="card-header">
            <h2 class="card-title">Company Information</h2>
          </div>
          <div class="form-grid">
            <div class="form-group">
              <label class="form-label">Company Name</label>
              <input type="text" class="form-input" id="companyName" value="Stoneside Custom Homes" />
            </div>
            <div class="form-group">
              <label class="form-label">Established Year</label>
              <input type="text" class="form-input" id="establishedYear" value="1984" />
            </div>
            <div class="form-group full-width">
              <label class="form-label">Location</label>
              <input type="text" class="form-input" id="siteLocation" value="Bryan–College Station, Texas" />
            </div>
          </div>
        </div>

        <div class="card">
          <div class="card-header">
            <h2 class="card-title">Scripture (Footer)</h2>
          </div>
          <div class="form-grid">
            <div class="form-group full-width">
              <label class="form-label">Scripture Verse</label>
              <input type="text" class="form-input" id="scriptureVerse" value="Unless the Lord builds the house, the builders labor in vain." />
            </div>
            <div class="form-group">
              <label class="form-label">Reference</label>
              <input type="text" class="form-input" id="scriptureRef" value="Psalm 127:1" />
            </div>
          </div>
        </div>

        <div class="card">
          <div class="card-header">
            <h2 class="card-title">Change Password</h2>
          </div>
          <div class="form-grid">
            <div class="form-group">
              <label class="form-label">New Password</label>
              <input type="password" class="form-input" id="newPassword" placeholder="Min 6 characters" />
            </div>
            <div class="form-group" style="display: flex; align-items: flex-end;">
              <button class="btn btn-secondary" id="changePasswordBtn">Update Password</button>
            </div>
          </div>
        </div>

        <div class="card">
          <div class="card-header">
            <h2 class="card-title">Data Management</h2>
          </div>
          <div style="display: flex; gap: 12px; flex-wrap: wrap;">
            <button class="btn btn-secondary" id="exportData">Export All Data</button>
            <button class="btn btn-danger" id="resetContent">Reset to Defaults</button>
          </div>
        </div>
      </section>

    </main>
  </div>

  <!-- Project Modal -->
  <div class="modal-overlay" id="projectModal">
    <div class="modal">
      <div class="modal-header">
        <h3 class="modal-title" id="projectModalTitle">Add Project</h3>
        <button class="modal-close" id="closeProjectModal">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/>
          </svg>
        </button>
      </div>
      <div class="modal-body">
        <form id="projectForm">
          <input type="hidden" id="projectId" />
          <div class="form-grid">
            <div class="form-group full-width">
              <label class="form-label">Project Title</label>
              <input type="text" class="form-input" id="projectTitle" required />
            </div>
            <div class="form-group">
              <label class="form-label">Type</label>
              <select class="form-select" id="projectType">
                <option value="custom">Custom Build</option>
                <option value="spec">Spec Home</option>
              </select>
            </div>
            <div class="form-group">
              <label class="form-label">Location</label>
              <input type="text" class="form-input" id="projectLocation" required />
            </div>
            <div class="form-group">
              <label class="form-label">Square Feet</label>
              <input type="text" class="form-input" id="projectSqft" placeholder="3,500" />
            </div>
            <div class="form-group">
              <label class="form-label">Bedrooms</label>
              <input type="text" class="form-input" id="projectBeds" placeholder="4" />
            </div>
            <div class="form-group">
              <label class="form-label">Bathrooms</label>
              <input type="text" class="form-input" id="projectBaths" placeholder="3.5" />
            </div>
            <div class="form-group">
              <label class="form-label">Year</label>
              <input type="text" class="form-input" id="projectYear" placeholder="2024" />
            </div>
            <div class="form-group full-width">
              <label class="form-label">Description</label>
              <textarea class="form-textarea" id="projectDescription"></textarea>
            </div>
            <div class="form-group">
              <label class="form-label">Photo URL</label>
              <input type="text" class="form-input" id="projectPhoto" placeholder="assets/images/..." />
            </div>
            <div class="form-group">
              <label class="form-label">Sketch URL</label>
              <input type="text" class="form-input" id="projectSketch" placeholder="assets/images/..." />
            </div>
            <div class="form-group full-width">
              <label class="form-label">Scripture Verse (optional)</label>
              <input type="text" class="form-input" id="projectVerseText" />
            </div>
            <div class="form-group">
              <label class="form-label">Scripture Reference</label>
              <input type="text" class="form-input" id="projectVerseRef" placeholder="Proverbs 24:3" />
            </div>
          </div>
        </form>
      </div>
      <div class="modal-footer">
        <button class="btn btn-secondary" id="cancelProject">Cancel</button>
        <button class="btn btn-primary" id="saveProject">Save Project</button>
      </div>
    </div>
  </div>

  <script>
    // ════════════════════════════════════════════════════════════════
    // INITIALIZATION & CONFIG
    // ════════════════════════════════════════════════════════════════
    // Use the database connection we created in the <head>

    document.addEventListener('DOMContentLoaded', () => {
      initAuth();
      initNavigation();
      initTabs();
      initSaveButtons();
      initProjectEditor();
      loadAllContent(); // Loads from Cloud
    });

    // ════════════════════════════════════════════════════════════════
    // AUTHENTICATION (Firebase Auth)
    // ════════════════════════════════════════════════════════════════
    function initAuth() {
      const loginForm = document.getElementById('loginForm');
      const loginBtn = document.getElementById('loginBtn');
      const loginError = document.getElementById('loginError');
      const logoutBtn = document.getElementById('logoutBtn');
      const auth = firebase.auth();

      // Listen for auth state changes
      auth.onAuthStateChanged((user) => {
        if (user) {
          showDashboard();
        } else {
          document.getElementById('loginScreen').classList.remove('hidden');
          document.getElementById('adminDashboard').classList.add('hidden');
        }
      });

      // Login handler
      loginForm.addEventListener('submit', async (e) => {
        e.preventDefault();
        loginError.style.display = 'none';
        loginBtn.disabled = true;
        loginBtn.textContent = 'Signing in...';

        const email = document.getElementById('loginEmail').value;
        const password = document.getElementById('loginPassword').value;

        try {
          await auth.signInWithEmailAndPassword(email, password);
          showToast('Welcome back!', 'success');
        } catch (err) {
          let msg = 'Invalid credentials. Please try again.';
          if (err.code === 'auth/user-not-found') msg = 'No account found with this email.';
          if (err.code === 'auth/wrong-password') msg = 'Incorrect password.';
          if (err.code === 'auth/too-many-requests') msg = 'Too many attempts. Try again later.';
          if (err.code === 'auth/invalid-credential') msg = 'Invalid email or password.';
          loginError.textContent = msg;
          loginError.style.display = 'block';
        } finally {
          loginBtn.disabled = false;
          loginBtn.textContent = 'Sign In';
        }
      });

      // Logout handler
      logoutBtn.addEventListener('click', async () => {
        await auth.signOut();
        location.reload();
      });

      // Change password handler
      const changePwBtn = document.getElementById('changePasswordBtn');
      if (changePwBtn) {
        changePwBtn.addEventListener('click', async () => {
          const newPass = document.getElementById('newPassword').value;
          if (!newPass || newPass.length < 6) {
            showToast('Password must be at least 6 characters.', 'error');
            return;
          }
          try {
            await auth.currentUser.updatePassword(newPass);
            document.getElementById('newPassword').value = '';
            showToast('Password updated!', 'success');
          } catch (err) {
            if (err.code === 'auth/requires-recent-login') {
              showToast('Please log out and log back in, then try changing your password.', 'error');
            } else {
              showToast('Error: ' + err.message, 'error');
            }
          }
        });
      }
    }

    function showDashboard() {
      document.getElementById('loginScreen').classList.add('hidden');
      document.getElementById('adminDashboard').classList.remove('hidden');
    }

    // ════════════════════════════════════════════════════════════════
    // CLOUD LOADERS (Read from Firebase)
    // ════════════════════════════════════════════════════════════════
    function loadAllContent() {
      showToast('Loading data from cloud...', 'success');
      
      db.ref('/').once('value').then((snapshot) => {
        const data = snapshot.val() || {};
        
        // 1. Load Hero
        if (data.hero) {
            const h = data.hero;
            setVal('heroTitle1Word1', h.title1Word1);
            setVal('heroTitle1Word2', h.title1Word2);
            setVal('heroTitle2Word1', h.title2Word1);
            setVal('heroTitle2Word2', h.title2Word2);
            setVal('heroSubtitle', h.subtitle);
            setVal('heroLocation', h.location);
            setVal('heroYears', h.years);
            setVal('stat1Value', h.stat1Value);
            setVal('stat1Label', h.stat1Label);
            setVal('stat2Value', h.stat2Value);
            setVal('stat2Label', h.stat2Label);
            setVal('stat3Value', h.stat3Value);
            setVal('stat3Label', h.stat3Label);
        }

        // 2. Load Content
        if (data.content) {
            const c = data.content;
            setVal('legacyTitle', c.legacyTitle);
            setVal('legacyLead', c.legacyLead);
            setVal('philosophyTitle', c.philosophyTitle);
            setVal('philosophyLead', c.philosophyLead);
            setVal('philosophyVerse', c.philosophyVerse);
            setVal('philosophyVerseRef', c.philosophyVerseRef);
            setVal('portfolioTitle', c.portfolioTitle);
            setVal('portfolioLead', c.portfolioLead);
            setVal('processTitle', c.processTitle);
            setVal('contactTitle', c.contactTitle);
            setVal('contactLead', c.contactLead);
        }

        // 3. Load Contact Info
        if (data.contact) {
            setVal('contactLocation', data.contact.location);
            setVal('contactPhone', data.contact.phone);
            setVal('contactEmail', data.contact.email);
            setVal('contactResponse', data.contact.response);
        }

        // 4. Load Settings
        if (data.settings) {
            setVal('companyName', data.settings.companyName);
            setVal('establishedYear', data.settings.establishedYear);
            setVal('siteLocation', data.settings.location);
            setVal('scriptureVerse', data.settings.scriptureVerse);
            setVal('scriptureRef', data.settings.scriptureRef);
        }

        // 5. Load Arrays (Timeline, Pillars, Process, Testimonials, Projects)
        // Helper to handle Firebase arrays (sometimes return as objects)
        const toArray = (obj) => obj ? (Array.isArray(obj) ? obj : Object.values(obj)) : [];

        renderTimeline(toArray(data.timeline).length ? toArray(data.timeline) : getDefaultTimeline());
        renderPillars(toArray(data.pillars).length ? toArray(data.pillars) : getDefaultPillars());
        renderProcessSteps(toArray(data.process).length ? toArray(data.process) : getDefaultProcessSteps());
        renderTestimonials(toArray(data.testimonials).length ? toArray(data.testimonials) : getDefaultTestimonials());
        renderProjects(toArray(data.projects).length ? toArray(data.projects) : getDefaultProjects());

      }).catch(err => {
          console.error(err);
          showToast('Error loading data', 'error');
      });
    }

    // Helper to safely set input values
    function setVal(id, val) {
        const el = document.getElementById(id);
        if (el) el.value = val || '';
    }

    // ════════════════════════════════════════════════════════════════
    // CLOUD SAVERS (Write to Firebase)
    // ════════════════════════════════════════════════════════════════
    
    function saveHeroContent() {
      const data = {
        title1Word1: document.getElementById('heroTitle1Word1').value,
        title1Word2: document.getElementById('heroTitle1Word2').value,
        title2Word1: document.getElementById('heroTitle2Word1').value,
        title2Word2: document.getElementById('heroTitle2Word2').value,
        subtitle: document.getElementById('heroSubtitle').value,
        location: document.getElementById('heroLocation').value,
        years: document.getElementById('heroYears').value,
        stat1Value: document.getElementById('stat1Value').value,
        stat1Label: document.getElementById('stat1Label').value,
        stat2Value: document.getElementById('stat2Value').value,
        stat2Label: document.getElementById('stat2Label').value,
        stat3Value: document.getElementById('stat3Value').value,
        stat3Label: document.getElementById('stat3Label').value
      };
      
      db.ref('hero').set(data)
        .then(() => showToast('Hero saved live!', 'success'))
        .catch(e => showToast('Error: ' + e.message, 'error'));
    }

    function savePageContent() {
      // 1. Text Content
      const pageContent = {
        legacyTitle: document.getElementById('legacyTitle').value,
        legacyLead: document.getElementById('legacyLead').value,
        philosophyTitle: document.getElementById('philosophyTitle').value,
        philosophyLead: document.getElementById('philosophyLead').value,
        philosophyVerse: document.getElementById('philosophyVerse').value,
        philosophyVerseRef: document.getElementById('philosophyVerseRef').value,
        portfolioTitle: document.getElementById('portfolioTitle').value,
        portfolioLead: document.getElementById('portfolioLead').value,
        processTitle: document.getElementById('processTitle').value,
        contactTitle: document.getElementById('contactTitle').value,
        contactLead: document.getElementById('contactLead').value
      };

      // 2. Timeline List
      const timelineItems = [];
      document.querySelectorAll('#timelineList .editable-item').forEach(item => {
        timelineItems.push({
          year: item.querySelector('[data-field="year"]').value,
          title: item.querySelector('[data-field="title"]').value,
          text: item.querySelector('[data-field="text"]').value
        });
      });

      // 3. Pillars List
      const pillarItems = [];
      document.querySelectorAll('#pillarsList .editable-item').forEach(item => {
        pillarItems.push({
          num: item.querySelector('[data-field="num"]').value,
          title: item.querySelector('[data-field="title"]').value,
          text: item.querySelector('[data-field="text"]').value
        });
      });

      // 4. Process List
      const processItems = [];
      document.querySelectorAll('#processStepsList .editable-item').forEach(item => {
        processItems.push({
          num: item.querySelector('[data-field="num"]').value,
          title: item.querySelector('[data-field="title"]').value,
          text: item.querySelector('[data-field="text"]').value,
          icon: item.querySelector('[data-field="icon"]').value
        });
      });

      // 5. Contact Info
      const contactInfo = {
        location: document.getElementById('contactLocation').value,
        phone: document.getElementById('contactPhone').value,
        email: document.getElementById('contactEmail').value,
        response: document.getElementById('contactResponse').value
      };

      // Perform Batch Update to Firebase
      const updates = {};
      updates['/content'] = pageContent;
      updates['/timeline'] = timelineItems;
      updates['/pillars'] = pillarItems;
      updates['/process'] = processItems;
      updates['/contact'] = contactInfo;

      db.ref().update(updates)
        .then(() => showToast('All content saved live!', 'success'))
        .catch(e => showToast('Error: ' + e.message, 'error'));
    }

    function saveTestimonials() {
      const items = [];
      document.querySelectorAll('#testimonialsList .editable-item').forEach(item => {
        items.push({
          quote: item.querySelector('[data-field="quote"]').value,
          name: item.querySelector('[data-field="name"]').value,
          detail: item.querySelector('[data-field="detail"]').value
        });
      });
      
      db.ref('testimonials').set(items)
        .then(() => showToast('Testimonials saved live!', 'success'))
        .catch(e => showToast('Error: ' + e.message, 'error'));
    }

    function saveSettings() {
      const settings = {
        companyName: document.getElementById('companyName').value,
        establishedYear: document.getElementById('establishedYear').value,
        location: document.getElementById('siteLocation').value,
        scriptureVerse: document.getElementById('scriptureVerse').value,
        scriptureRef: document.getElementById('scriptureRef').value
      };
      
      db.ref('settings').set(settings)
        .then(() => showToast('Settings saved live!', 'success'))
        .catch(e => showToast('Error: ' + e.message, 'error'));
    }

    function saveProject() {
      // Get current projects first to append or edit
      db.ref('projects').once('value').then(snapshot => {
          let projects = snapshot.val() || [];
          if (typeof projects === 'object' && !Array.isArray(projects)) projects = Object.values(projects);

          const id = document.getElementById('projectId').value;
          const projectData = {
            id: id ? parseInt(id) : Date.now(),
            title: document.getElementById('projectTitle').value,
            type: document.getElementById('projectType').value,
            location: document.getElementById('projectLocation').value,
            sqft: document.getElementById('projectSqft').value,
            beds: document.getElementById('projectBeds').value,
            baths: document.getElementById('projectBaths').value,
            year: document.getElementById('projectYear').value,
            description: document.getElementById('projectDescription').value,
            photo: document.getElementById('projectPhoto').value || 'assets/images/custom_home.jpg',
            sketch: document.getElementById('projectSketch').value || 'assets/images/hero-sketch.jpg',
            verseText: document.getElementById('projectVerseText').value,
            verseRef: document.getElementById('projectVerseRef').value
          };
          
          if (id) {
            const index = projects.findIndex(p => p.id === parseInt(id));
            if (index !== -1) projects[index] = projectData;
          } else {
            projects.push(projectData);
          }
          
          db.ref('projects').set(projects)
            .then(() => {
                renderProjects(projects);
                closeProjectModal();
                showToast('Project saved live!', 'success');
            });
      });
    }
    
    function deleteProject(id) {
        if (!confirm('Delete this project?')) return;
        db.ref('projects').once('value').then(snapshot => {
            let projects = snapshot.val() || [];
            if (typeof projects === 'object' && !Array.isArray(projects)) projects = Object.values(projects);
            
            const newProjects = projects.filter(p => p.id !== id);
            
            db.ref('projects').set(newProjects)
            .then(() => {
                renderProjects(newProjects);
                showToast('Project deleted', 'success');
            });
        });
    }

    // ════════════════════════════════════════════════════════════════
    // UI HELPERS (Tabs, Nav, Lists - Same as before)
    // ════════════════════════════════════════════════════════════════
    function initNavigation() {
      const navLinks = document.querySelectorAll('.nav-link[data-section]');
      navLinks.forEach(link => {
        link.addEventListener('click', (e) => {
          e.preventDefault();
          const sectionId = link.dataset.section;
          navLinks.forEach(l => l.classList.remove('active'));
          link.classList.add('active');
          document.querySelectorAll('.section-content').forEach(s => s.classList.remove('active'));
          document.getElementById(`section-${sectionId}`).classList.add('active');
        });
      });
    }

    function initTabs() {
      document.querySelectorAll('.tab').forEach(tab => {
        tab.addEventListener('click', () => {
          const tabId = tab.dataset.tab;
          const parent = tab.closest('.section-content');
          parent.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
          tab.classList.add('active');
          parent.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
          parent.querySelector(`#tab-${tabId}`).classList.add('active');
        });
      });
    }

    function initSaveButtons() {
      document.getElementById('saveHero').addEventListener('click', saveHeroContent);
      document.getElementById('saveContent').addEventListener('click', savePageContent);
      document.getElementById('saveSettings').addEventListener('click', saveSettings);
      document.getElementById('saveTestimonials').addEventListener('click', saveTestimonials);
      
      // We don't need "Reset to Defaults" anymore because we want the Cloud data
      document.getElementById('resetContent').style.display = 'none'; 
      document.getElementById('exportData').style.display = 'none'; // Not needed with Cloud

      // Dynamic list buttons
      document.getElementById('addTimelineItem').addEventListener('click', () => addTimelineItem());
      document.getElementById('addPillar').addEventListener('click', () => addPillar());
      document.getElementById('addProcessStep').addEventListener('click', () => addProcessStep());
      document.getElementById('addTestimonial').addEventListener('click', () => addTestimonial());
    }

    // UI RENDERERS
    function renderTimeline(items) {
      const list = document.getElementById('timelineList');
      list.innerHTML = items.map((item, i) => `
        <div class="editable-item" data-index="${i}">
          <div class="editable-item-content">
            <div class="editable-item-row"><label>Year</label><input type="text" class="form-input" value="${item.year}" data-field="year" /></div>
            <div class="editable-item-row"><label>Title</label><input type="text" class="form-input" value="${item.title}" data-field="title" /></div>
            <div class="editable-item-row"><label>Text</label><textarea class="form-textarea" data-field="text">${item.text}</textarea></div>
          </div>
          <div class="editable-item-actions">
             <button class="btn btn-icon btn-danger" onclick="this.closest('.editable-item').remove()">×</button>
          </div>
        </div>
      `).join('');
    }

    function addTimelineItem() {
        const list = document.getElementById('timelineList');
        const i = list.children.length;
        list.insertAdjacentHTML('beforeend', `
        <div class="editable-item" data-index="${i}">
          <div class="editable-item-content">
            <div class="editable-item-row"><label>Year</label><input type="text" class="form-input" value="20XX" data-field="year" /></div>
            <div class="editable-item-row"><label>Title</label><input type="text" class="form-input" value="New Milestone" data-field="title" /></div>
            <div class="editable-item-row"><label>Text</label><textarea class="form-textarea" data-field="text"></textarea></div>
          </div>
          <div class="editable-item-actions">
             <button class="btn btn-icon btn-danger" onclick="this.closest('.editable-item').remove()">×</button>
          </div>
        </div>`);
    }

    function renderPillars(items) {
      const list = document.getElementById('pillarsList');
      list.innerHTML = items.map((item, i) => `
        <div class="editable-item" data-index="${i}">
          <div class="editable-item-content">
            <div class="editable-item-row"><label>#</label><input type="text" class="form-input" value="${item.num}" data-field="num" /></div>
            <div class="editable-item-row"><label>Title</label><input type="text" class="form-input" value="${item.title}" data-field="title" /></div>
            <div class="editable-item-row"><label>Text</label><textarea class="form-textarea" data-field="text">${item.text}</textarea></div>
          </div>
          <div class="editable-item-actions"><button class="btn btn-icon btn-danger" onclick="this.closest('.editable-item').remove()">×</button></div>
        </div>
      `).join('');
    }
    
    function addPillar() {
        document.getElementById('pillarsList').insertAdjacentHTML('beforeend', `
        <div class="editable-item">
          <div class="editable-item-content">
            <div class="editable-item-row"><label>#</label><input type="text" class="form-input" value="IV" data-field="num" /></div>
            <div class="editable-item-row"><label>Title</label><input type="text" class="form-input" value="Title" data-field="title" /></div>
            <div class="editable-item-row"><label>Text</label><textarea class="form-textarea" data-field="text"></textarea></div>
          </div>
          <div class="editable-item-actions"><button class="btn btn-icon btn-danger" onclick="this.closest('.editable-item').remove()">×</button></div>
        </div>`);
    }

    function renderProcessSteps(items) {
      const list = document.getElementById('processStepsList');
      list.innerHTML = items.map((item, i) => `
        <div class="editable-item" data-index="${i}">
          <div class="editable-item-content">
            <div class="editable-item-row"><label>#</label><input type="text" class="form-input" value="${item.num}" data-field="num" /></div>
            <div class="editable-item-row"><label>Title</label><input type="text" class="form-input" value="${item.title}" data-field="title" /></div>
            <div class="editable-item-row"><label>Icon</label><select class="form-select" data-field="icon"><option value="plus">Plus</option><option value="home">Home</option></select></div>
            <div class="editable-item-row"><label>Text</label><textarea class="form-textarea" data-field="text">${item.text}</textarea></div>
          </div>
          <div class="editable-item-actions"><button class="btn btn-icon btn-danger" onclick="this.closest('.editable-item').remove()">×</button></div>
        </div>
      `).join('');
    }
    
    function addProcessStep() {
       document.getElementById('processStepsList').insertAdjacentHTML('beforeend', `
        <div class="editable-item">
          <div class="editable-item-content">
            <div class="editable-item-row"><label>#</label><input type="text" class="form-input" value="00" data-field="num" /></div>
            <div class="editable-item-row"><label>Title</label><input type="text" class="form-input" value="Step" data-field="title" /></div>
            <div class="editable-item-row"><label>Icon</label><select class="form-select" data-field="icon"><option value="plus">Plus</option><option value="home">Home</option></select></div>
            <div class="editable-item-row"><label>Text</label><textarea class="form-textarea" data-field="text"></textarea></div>
          </div>
          <div class="editable-item-actions"><button class="btn btn-icon btn-danger" onclick="this.closest('.editable-item').remove()">×</button></div>
        </div>`);
    }

    function renderTestimonials(items) {
      const list = document.getElementById('testimonialsList');
      list.innerHTML = items.map((item, i) => `
        <div class="editable-item" data-index="${i}">
          <div class="editable-item-content">
            <div class="editable-item-row"><label>Quote</label><textarea class="form-textarea" data-field="quote">${item.quote}</textarea></div>
            <div class="editable-item-row"><label>Name</label><input type="text" class="form-input" value="${item.name}" data-field="name" /></div>
            <div class="editable-item-row"><label>Detail</label><input type="text" class="form-input" value="${item.detail}" data-field="detail" /></div>
          </div>
          <div class="editable-item-actions"><button class="btn btn-icon btn-danger" onclick="this.closest('.editable-item').remove()">×</button></div>
        </div>
      `).join('');
    }
    
    function addTestimonial() {
        document.getElementById('testimonialsList').insertAdjacentHTML('beforeend', `
        <div class="editable-item">
          <div class="editable-item-content">
            <div class="editable-item-row"><label>Quote</label><textarea class="form-textarea" data-field="quote"></textarea></div>
            <div class="editable-item-row"><label>Name</label><input type="text" class="form-input" value="Name" data-field="name" /></div>
            <div class="editable-item-row"><label>Detail</label><input type="text" class="form-input" value="Detail" data-field="detail" /></div>
          </div>
          <div class="editable-item-actions"><button class="btn btn-icon btn-danger" onclick="this.closest('.editable-item').remove()">×</button></div>
        </div>`);
    }

    // Projects
    function initProjectEditor() {
      document.getElementById('addProject').addEventListener('click', () => openProjectModal());
      document.getElementById('closeProjectModal').addEventListener('click', closeProjectModal);
      document.getElementById('cancelProject').addEventListener('click', closeProjectModal);
      document.getElementById('saveProject').addEventListener('click', saveProject);
      document.getElementById('projectModal').addEventListener('click', (e) => {
        if (e.target.id === 'projectModal') closeProjectModal();
      });
    }

    function renderProjects(projects) {
      const grid = document.getElementById('projectsGrid');
      grid.innerHTML = projects.map(p => `
        <div class="project-card" data-id="${p.id}">
          <img class="project-card-image" src="${p.photo || 'assets/images/custom_home.jpg'}" alt="${p.title}" />
          <div class="project-card-content">
            <div class="project-card-type">${p.type === 'custom' ? 'Custom Build' : 'Spec Home'}</div>
            <div class="project-card-title">${p.title}</div>
            <div class="project-card-meta">${p.location}</div>
            <div class="project-card-actions">
              <button class="btn btn-secondary btn-sm" onclick="editProject(${p.id})">Edit</button>
              <button class="btn btn-danger btn-sm" onclick="deleteProject(${p.id})">Delete</button>
            </div>
          </div>
        </div>
      `).join('');
    }

    function openProjectModal(project = null) {
      document.getElementById('projectModalTitle').textContent = project ? 'Edit Project' : 'Add Project';
      document.getElementById('projectId').value = project ? project.id : '';
      document.getElementById('projectTitle').value = project ? project.title : '';
      document.getElementById('projectType').value = project ? project.type : 'custom';
      document.getElementById('projectLocation').value = project ? project.location : '';
      document.getElementById('projectSqft').value = project ? project.sqft : '';
      document.getElementById('projectBeds').value = project ? project.beds : '';
      document.getElementById('projectBaths').value = project ? project.baths : '';
      document.getElementById('projectYear').value = project ? project.year : '';
      document.getElementById('projectDescription').value = project ? project.description : '';
      document.getElementById('projectPhoto').value = project ? project.photo : '';
      document.getElementById('projectSketch').value = project ? project.sketch : '';
      document.getElementById('projectVerseText').value = project ? project.verseText : '';
      document.getElementById('projectVerseRef').value = project ? project.verseRef : '';
      document.getElementById('projectModal').classList.add('active');
    }

    function closeProjectModal() {
      document.getElementById('projectModal').classList.remove('active');
    }

    function editProject(id) {
       db.ref('projects').once('value').then(snapshot => {
          let projects = snapshot.val() || [];
          if (typeof projects === 'object' && !Array.isArray(projects)) projects = Object.values(projects);
          const project = projects.find(p => p.id === id);
          if (project) openProjectModal(project);
       });
    }

    // Default Data Providers (for when database is empty)
    function getDefaultTimeline() { return [{ year: '1984', title: 'Founded', text: 'Stoneside Homes begins.' }]; }
    function getDefaultPillars() { return [{ num: 'I', title: 'Quality', text: 'We build with care.' }]; }
    function getDefaultProcessSteps() { return [{ num: '01', title: 'Meet', text: 'We start with a conversation.', icon: 'plus' }]; }
    function getDefaultTestimonials() { return [{ quote: 'Amazing builder.', name: 'The Smiths', detail: '2024' }]; }
    function getDefaultProjects() { return []; }

    // Toast
    function showToast(message, type = 'success') {
      const container = document.getElementById('toastContainer');
      const toast = document.createElement('div');
      toast.className = `toast ${type}`;
      toast.innerHTML = `<span class="toast-message">${message}</span>`;
      container.appendChild(toast);
      setTimeout(() => toast.remove(), 3000);
    }
  </script>
</body>
</html>
